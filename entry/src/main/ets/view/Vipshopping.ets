
// æ¥å£å®šä¹‰
interface BannerItem {
  image: string;
  title: string;
}

interface CategoryItem {
  icon: string;
  name: string;
  color: string;
}

interface ProductItem {
  image: string;
  title: string;
  price: string;
  originalPrice: string;
  tag: string;
}

@Component
export struct Vipshopping {
  @State selectedTab: number = 0;
  @State currentBanner: number = 0;
  private bannerTimer: number = -1;

  // è½®æ’­å›¾æ•°æ®
  private bannerData: BannerItem[] = [
    { image: 'https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/KJunX09bM4.png', title: 'Bç«™ä¼šå‘˜ä¸“äº«å•†å“' },
    { image: 'https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/VEzQJdAzSI.png', title: 'é™æ—¶ä¼˜æƒ æ´»åŠ¨' },
    { image: 'https://i0.hdslb.com/bfs/activity-plat/static/20220614/e369244d0b14644f5e1a06431e22a4d5/MjQxOTY4NzY.png', title: 'æ–°å“é¦–å‘' }
  ];

  // å•†å“åˆ†ç±»æ•°æ®
  private categoryData: CategoryItem[] = [
    { icon: 'ğŸ®', name: 'æ¸¸æˆå‘¨è¾¹', color: '#FF6B9D' },
    { icon: 'ğŸ‘•', name: 'æœé¥°é…ä»¶', color: '#4ECDC4' },
    { icon: 'ğŸ“±', name: 'æ•°ç äº§å“', color: '#45B7D1' },
    { icon: 'ğŸ¨', name: 'æ–‡åˆ›ç”¨å“', color: '#96CEB4' },
    { icon: 'ğŸ ', name: 'ç”Ÿæ´»ç”¨å“', color: '#FFEAA7' },
    { icon: 'ğŸ“š', name: 'å›¾ä¹¦éŸ³åƒ', color: '#DDA0DD' },
    { icon: 'ğŸ­', name: 'é›¶é£Ÿé¥®å“', color: '#FFB6C1' },
    { icon: 'ğŸ', name: 'ç¤¼å“å¡åˆ¸', color: '#87CEEB' }
  ];

  // æ¨èå•†å“æ•°æ®
  private productData: ProductItem[] = [
    { image: 'https://i0.hdslb.com/bfs/mall/mall/b8/85/b885c2b35f3d0f5c9b8c8f5c9b8c8f5c.png', title: 'Bç«™22å¨˜æ‰‹åŠæ¨¡å‹', price: 'Â¥299', originalPrice: 'Â¥399', tag: 'ä¼šå‘˜ä¸“äº«' },
    { image: 'https://i0.hdslb.com/bfs/mall/mall/c9/96/c996d3c46f4e1f6d0c9d9f6d0c9d9f6d.png', title: 'bilibiliå‘¨è¾¹Tæ¤', price: 'Â¥89', originalPrice: 'Â¥129', tag: 'é™æ—¶ç‰¹ä»·' },
    { image: 'https://i0.hdslb.com/bfs/mall/mall/d0/a7/d0a7e4d57f5f2f7e1d0e0f7e1d0e0f7e.png', title: 'Bç«™å®šåˆ¶é©¬å…‹æ¯', price: 'Â¥39', originalPrice: 'Â¥59', tag: 'æ–°å“ä¸Šå¸‚' },
    { image: 'https://i0.hdslb.com/bfs/mall/mall/e1/b8/e1b8f5e68f6f3f8f2e1f1f8f2e1f1f8f.png', title: 'UPä¸»è”åå¾½ç« ', price: 'Â¥19', originalPrice: 'Â¥29', tag: 'çƒ­é”€' }
  ];

  aboutToAppear() {
    // å¯åŠ¨è½®æ’­å›¾å®šæ—¶å™¨
    this.bannerTimer = setInterval(() => {
      this.currentBanner = (this.currentBanner + 1) % this.bannerData.length;
    }, 3000);
  }

  aboutToDisappear() {
    // æ¸…é™¤å®šæ—¶å™¨
    if (this.bannerTimer !== -1) {
      clearInterval(this.bannerTimer);
    }
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      this.buildHeader()
      
      // ä¸»è¦å†…å®¹åŒºåŸŸ
      Scroll() {
        Column({ space: 16 }) {
          // è½®æ’­å›¾
          this.buildBanner()
          
          // ä¼šå‘˜ç‰¹æƒå¡ç‰‡
          this.buildVipPrivileges()
          
          // å•†å“åˆ†ç±»
          this.buildCategories()
          
          // ä¼˜æƒ åˆ¸åŒºåŸŸ
          this.buildCoupons()
          
          // æ¨èå•†å“
          this.buildRecommendProducts()
          
          // åº•éƒ¨é—´è·
          Blank().height(20)
        }
        .padding({ left: 16, right: 16 })
      }
      .scrollBar(BarState.Off)
      .backgroundColor('#F8F9FA')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#FFFFFF')
  }

  // æ„å»ºé¡¶éƒ¨å¯¼èˆªæ 
  @Builder
  buildHeader() {
    Row() {
      Text('ä¼šå‘˜è´­ç‰©')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .fontColor('#333333')
      
      Blank()
      
      Row({ space: 16 }) {
        Text('ğŸ”')
          .fontSize(20)
          .onClick(() => {
            // æœç´¢åŠŸèƒ½
          })
        
        Text('ğŸ›’')
          .fontSize(20)
          .onClick(() => {
            // è´­ç‰©è½¦åŠŸèƒ½
          })
      }
    }
    .width('100%')
    .height(56)
    .padding({ left: 16, right: 16 })
    .backgroundColor('#FFFFFF')
    .shadow({ radius: 2, color: '#1A000000', offsetY: 1 })
  }

  // æ„å»ºè½®æ’­å›¾
  @Builder
  buildBanner() {
    Stack() {
      Swiper() {
        ForEach(this.bannerData, (item: BannerItem) => {
          Stack() {
            Image(item.image)
              .width('100%')
              .height(180)
              .borderRadius(12)
              .objectFit(ImageFit.Cover)
              .alt($r('app.media.photo35'))
            
            // æ¸å˜é®ç½©
            Column()
              .width('100%')
              .height(60)
              .linearGradient({
                direction: GradientDirection.Bottom,
                colors: [['#00000000', 0.0], ['#80000000', 1.0]]
              })
              .borderRadius({ bottomLeft: 12, bottomRight: 12 })
              .position({ x: 0, y: 120 })
            
            // æ ‡é¢˜
            Text(item.title)
              .fontSize(16)
              .fontColor('#FFFFFF')
              .fontWeight(FontWeight.Medium)
              .position({ x: 16, y: 140 })
          }
        })
      }
      .width('100%')
      .height(180)
      .borderRadius(12)
      .autoPlay(true)
      .interval(3000)
      .indicator(false)
      .onChange((index: number) => {
        this.currentBanner = index;
      })
      
      // è‡ªå®šä¹‰æŒ‡ç¤ºå™¨
      Row({ space: 6 }) {
        ForEach(this.bannerData, (item: BannerItem, index: number) => {
          Circle({ width: 6, height: 6 })
            .fill(this.currentBanner === index ? '#FF6B9D' : '#FFFFFF80')
        })
      }
      .position({ x: '50%', y: 160 })
      .translate({ x: '-50%' })
    }
    .margin({ top: 16 })
  }

  // æ„å»ºä¼šå‘˜ç‰¹æƒå¡ç‰‡
  @Builder
  buildVipPrivileges() {
    Column({ space: 12 }) {
      Row() {
        Text('ä¼šå‘˜ç‰¹æƒ')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
        
        Blank()
        
        Text('æŸ¥çœ‹å…¨éƒ¨ >')
          .fontSize(14)
          .fontColor('#FF6B9D')
      }
      .width('100%')
      
      Row({ space: 12 }) {
        // ä¸“äº«æŠ˜æ‰£
        Column({ space: 8 }) {
          Text('ğŸ’')
            .fontSize(24)
          Text('ä¸“äº«æŠ˜æ‰£')
            .fontSize(14)
            .fontColor('#333333')
          Text('9æŠ˜èµ·')
            .fontSize(12)
            .fontColor('#FF6B9D')
        }
        .width('25%')
        .height(80)
        .backgroundColor('#FFFFFF')
        .borderRadius(12)
        .justifyContent(FlexAlign.Center)
        .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
        
        // å…è´¹é…é€
        Column({ space: 8 }) {
          Text('ğŸšš')
            .fontSize(24)
          Text('å…è´¹é…é€')
            .fontSize(14)
            .fontColor('#333333')
          Text('åŒ…é‚®')
            .fontSize(12)
            .fontColor('#4ECDC4')
        }
        .width('25%')
        .height(80)
        .backgroundColor('#FFFFFF')
        .borderRadius(12)
        .justifyContent(FlexAlign.Center)
        .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
        
        // ä¸“å±å®¢æœ
        Column({ space: 8 }) {
          Text('ğŸ‘¥')
            .fontSize(24)
          Text('ä¸“å±å®¢æœ')
            .fontSize(14)
            .fontColor('#333333')
          Text('7x24h')
            .fontSize(12)
            .fontColor('#45B7D1')
        }
        .width('25%')
        .height(80)
        .backgroundColor('#FFFFFF')
        .borderRadius(12)
        .justifyContent(FlexAlign.Center)
        .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
        
        // ç§¯åˆ†è¿”è¿˜
        Column({ space: 8 }) {
          Text('â­')
            .fontSize(24)
          Text('ç§¯åˆ†è¿”è¿˜')
            .fontSize(14)
            .fontColor('#333333')
          Text('åŒå€')
            .fontSize(12)
            .fontColor('#FFEAA7')
        }
        .width('25%')
        .height(80)
        .backgroundColor('#FFFFFF')
        .borderRadius(12)
        .justifyContent(FlexAlign.Center)
        .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
      }
      .width('100%')
    }
    .margin({ top: 16 })
  }

  // æ„å»ºå•†å“åˆ†ç±»
  @Builder
  buildCategories() {
    Column({ space: 12 }) {
      Row() {
        Text('å•†å“åˆ†ç±»')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
      }
      .width('100%')
      
      Grid() {
        ForEach(this.categoryData, (item: CategoryItem) => {
          GridItem() {
            Column({ space: 8 }) {
              Text(item.icon)
                .fontSize(28)
              Text(item.name)
                .fontSize(12)
                .fontColor('#333333')
            }
            .width('100%')
            .height(80)
            .backgroundColor('#FFFFFF')
            .borderRadius(12)
            .justifyContent(FlexAlign.Center)
            .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
            .border({ width: 2, color: item.color, radius: 12 })
            .onClick(() => {
              // åˆ†ç±»ç‚¹å‡»äº‹ä»¶
            })
          }
        })
      }
      .columnsTemplate('1fr 1fr 1fr 1fr')
      .rowsTemplate('1fr 1fr')
      .columnsGap(12)
      .rowsGap(12)
      .width('100%')
      .height(172)
    }
    .margin({ top: 16 })
  }

  // æ„å»ºä¼˜æƒ åˆ¸åŒºåŸŸ
  @Builder
  buildCoupons() {
    Column({ space: 12 }) {
      Row() {
        Text('é™æ—¶ä¼˜æƒ åˆ¸')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
        
        Blank()
        
        Text('æ›´å¤šä¼˜æƒ  >')
          .fontSize(14)
          .fontColor('#FF6B9D')
      }
      .width('100%')
      
      Row({ space: 12 }) {
        // æ»¡å‡åˆ¸
        Row({ space: 12 }) {
          Column() {
            Text('Â¥20')
              .fontSize(20)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FFFFFF')
            Text('æ»¡100å¯ç”¨')
              .fontSize(10)
              .fontColor('#FFFFFF')
          }
          .width(60)
          .height(60)
          .backgroundColor('#FF6B9D')
          .borderRadius(8)
          .justifyContent(FlexAlign.Center)
          
          Column({ space: 4 }) {
            Text('æ»¡å‡åˆ¸')
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
              .fontColor('#333333')
            Text('æ»¡100å‡20')
              .fontSize(12)
              .fontColor('#666666')
            Text('æœ‰æ•ˆæœŸè‡³12-31')
              .fontSize(10)
              .fontColor('#999999')
          }
          .alignItems(HorizontalAlign.Start)
          .layoutWeight(1)
          
          Button('é¢†å–')
            .width(50)
            .height(28)
            .fontSize(12)
            .backgroundColor('#FF6B9D')
            .borderRadius(14)
        }
        .width('48%')
        .height(80)
        .backgroundColor('#FFFFFF')
        .borderRadius(12)
        .padding(12)
        .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
        
        // æŠ˜æ‰£åˆ¸
        Row({ space: 12 }) {
          Column() {
            Text('9æŠ˜')
              .fontSize(18)
              .fontWeight(FontWeight.Bold)
              .fontColor('#FFFFFF')
            Text('æ— é—¨æ§›')
              .fontSize(10)
              .fontColor('#FFFFFF')
          }
          .width(60)
          .height(60)
          .backgroundColor('#4ECDC4')
          .borderRadius(8)
          .justifyContent(FlexAlign.Center)
          
          Column({ space: 4 }) {
            Text('æŠ˜æ‰£åˆ¸')
              .fontSize(14)
              .fontWeight(FontWeight.Medium)
              .fontColor('#333333')
            Text('å…¨åœº9æŠ˜')
              .fontSize(12)
              .fontColor('#666666')
            Text('æœ‰æ•ˆæœŸè‡³12-31')
              .fontSize(10)
              .fontColor('#999999')
          }
          .alignItems(HorizontalAlign.Start)
          .layoutWeight(1)
          
          Button('é¢†å–')
            .width(50)
            .height(28)
            .fontSize(12)
            .backgroundColor('#4ECDC4')
            .borderRadius(14)
        }
        .width('48%')
        .height(80)
        .backgroundColor('#FFFFFF')
        .borderRadius(12)
        .padding(12)
        .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
      }
      .width('100%')
    }
    .margin({ top: 16 })
  }

  // æ„å»ºæ¨èå•†å“
  @Builder
  buildRecommendProducts() {
    Column({ space: 12 }) {
      Row() {
        Text('ä¸ºä½ æ¨è')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .fontColor('#333333')
        
        Blank()
        
        Text('æ¢ä¸€æ‰¹ ğŸ”„')
          .fontSize(14)
          .fontColor('#FF6B9D')
      }
      .width('100%')
      
      Grid() {
        ForEach(this.productData, (item: ProductItem) => {
          GridItem() {
            Column({ space: 8 }) {
              Stack() {
                Image(item.image)
                  .width('100%')
                  .height(120)
                  .borderRadius({ topLeft: 12, topRight: 12 })
                  .objectFit(ImageFit.Cover)
                  .alt($r('app.media.photo35'))
                
                // æ ‡ç­¾
                Text(item.tag)
                  .fontSize(10)
                  .fontColor('#FFFFFF')
                  .backgroundColor('#FF6B9D')
                  .padding({ left: 6, right: 6, top: 2, bottom: 2 })
                  .borderRadius(4)
                  .position({ x: 8, y: 8 })
              }
              
              Column({ space: 4 }) {
                Text(item.title)
                  .fontSize(14)
                  .fontColor('#333333')
                  .maxLines(2)
                  .textOverflow({ overflow: TextOverflow.Ellipsis })
                
                Row({ space: 8 }) {
                  Text(item.price)
                    .fontSize(16)
                    .fontWeight(FontWeight.Bold)
                    .fontColor('#FF6B9D')
                  
                  Text(item.originalPrice)
                    .fontSize(12)
                    .fontColor('#999999')
                    .decoration({ type: TextDecorationType.LineThrough })
                }
                .alignItems(VerticalAlign.Bottom)
              }
              .padding({ left: 8, right: 8, bottom: 8 })
              .alignItems(HorizontalAlign.Start)
            }
            .width('100%')
            .backgroundColor('#FFFFFF')
            .borderRadius(12)
            .shadow({ radius: 4, color: '#1A000000', offsetY: 2 })
            .onClick(() => {
              // å•†å“è¯¦æƒ…é¡µ
            })
          }
        })
      }
      .columnsTemplate('1fr 1fr')
      .columnsGap(12)
      .rowsGap(12)
      .width('100%')
    }
    .margin({ top: 16 })
  }
}